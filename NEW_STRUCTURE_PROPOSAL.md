# –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞

## üéØ –¶–µ–ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. –£–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –∫–æ–¥—É
2. –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –£–ª—É—á—à–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
4. –ü–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
5. –°–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º PHP (PSR)

## üìÅ –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
cabi.world/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/              # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (–Ω–æ–≤–∞—è –ø–∞–ø–∫–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Web/                  # –í–µ–±-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HomeController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfileController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ModpackController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SettingsController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AdminController.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Api/                  # API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AuthController.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ UserController.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ApplicationController.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ModpackController.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ChatController.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ NotificationController.php
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ AdminController.php
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Http/                     # HTTP —Å–ª–æ–π (–Ω–æ–≤–∞—è –ø–∞–ø–∫–∞)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Request.php           # –û–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ $_REQUEST
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Response.php          # –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Router.php            # –†–æ—É—Ç–µ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Middleware/           # Middleware
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AuthMiddleware.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AdminMiddleware.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CsrfMiddleware.php
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ RateLimitMiddleware.php
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ValidateRequestMiddleware.php
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Services/                 # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthService.php       # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å AuthManager
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImageService.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ValidationService.php # –ù–æ–≤–∞—è - –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RateLimitService.php  # –ù–æ–≤–∞—è - rate limiting
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CacheService.php      # –ù–æ–≤–∞—è - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Repository/                # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—É–±—Ä–∞—Ç—å —Ç—Ä–µ–π—Ç—ã)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserRepository.php    # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç—Ä–µ–π—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ApplicationRepository.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatMessageRepository.php # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç—Ä–µ–π—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CommunityRepository.php  # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç—Ä–µ–π—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ModpackRepository.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationRepository.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RefreshTokenRepository.php
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Core/                     # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Database.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DbFields.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Role.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Security.php
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Auth/                     # –£–ø—Ä–æ—Å—Ç–∏—Ç—å (—É–±—Ä–∞—Ç—å —Ç—Ä–µ–π—Ç—ã)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthService.php       # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å AuthManager + —Ç—Ä–µ–π—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ JWT.php
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Validators/               # –ù–æ–≤–∞—è –ø–∞–ø–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserValidator.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ApplicationValidator.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessageValidator.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ImageValidator.php
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ bootstrap.php
‚îÇ
‚îú‚îÄ‚îÄ routes/                       # –ù–æ–≤–∞—è –ø–∞–ø–∫–∞ (–≤–º–µ—Å—Ç–æ index/)
‚îÇ   ‚îú‚îÄ‚îÄ web.php                   # –í–µ–±-–º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ api.php                   # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ admin.php                 # –ê–¥–º–∏–Ω –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ config/                       # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ app.php
‚îÇ   ‚îî‚îÄ‚îÄ database.php
‚îÇ
‚îú‚îÄ‚îÄ public/                       # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ index.php                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îî‚îÄ‚îÄ uploads/
‚îÇ
‚îú‚îÄ‚îÄ templates/                    # –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ layouts/
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ components/
‚îÇ
‚îú‚îÄ‚îÄ storage/                      # –ù–æ–≤–∞—è –ø–∞–ø–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ cache/                    # –ö—ç—à
‚îÇ   ‚îú‚îÄ‚îÄ logs/                     # –õ–æ–≥–∏
‚îÇ   ‚îî‚îÄ‚îÄ sessions/                 # –°–µ—Å—Å–∏–∏ (–µ—Å–ª–∏ —Ñ–∞–π–ª–æ–≤—ã–µ)
‚îÇ
‚îî‚îÄ‚îÄ tests/                        # –ù–æ–≤–∞—è –ø–∞–ø–∫–∞ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)
    ‚îú‚îÄ‚îÄ Unit/
    ‚îî‚îÄ‚îÄ Feature/
```

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º

### 1. –†–æ—É—Ç–∏–Ω–≥

#### –ë—ã–ª–æ:
```php
// public/index.php
include_once '../index/RoutesAPI/RoutesAPI.php';
include_once '../index/Routes/.PageRoutes.php';
// ...
```

#### –°—Ç–∞–Ω–µ—Ç:
```php
// public/index.php
require_once dirname(__DIR__) . '/app/bootstrap.php';

use App\Http\Router;

$router = new Router();
require_once ROOT_PATH . '/routes/web.php';
require_once ROOT_PATH . '/routes/api.php';
require_once ROOT_PATH . '/routes/admin.php';

$router->dispatch();
```

#### routes/web.php:
```php
<?php
use App\Http\Router;
use App\Controllers\Web\HomeController;
use App\Controllers\Web\AuthController;
use App\Controllers\Web\ProfileController;
use App\Http\Middleware\AuthMiddleware;
use App\Http\Middleware\CsrfMiddleware;

Router::get('/', [HomeController::class, 'index']);

Router::get('/login', [AuthController::class, 'showLogin'])->middleware('guest');
Router::post('/login', [AuthController::class, 'login'])->middleware(['guest', 'csrf']);
Router::get('/register', [AuthController::class, 'showRegister'])->middleware('guest');
Router::post('/register', [AuthController::class, 'register'])->middleware(['guest', 'csrf']);

Router::get('/@:username', [ProfileController::class, 'show']);

Router::get('/settings', [SettingsController::class, 'index'])->middleware('auth');
// ...
```

#### routes/api.php:
```php
<?php
use App\Http\Router;
use App\Controllers\Api\AuthController;
use App\Controllers\Api\UserController;
use App\Http\Middleware\CsrfMiddleware;
use App\Http\Middleware\RateLimitMiddleware;

Router::prefix('/api')->group(function() {
    Router::post('/auth/login', [AuthController::class, 'login'])
        ->middleware(['csrf', 'rate_limit:5,60']); // 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
    
    Router::post('/auth/register', [AuthController::class, 'register'])
        ->middleware(['csrf', 'rate_limit:3,60']);
    
    Router::post('/auth/refresh', [AuthController::class, 'refresh'])
        ->middleware('csrf');
    
    Router::prefix('/user')->middleware('auth')->group(function() {
        Router::put('/update', [UserController::class, 'update']);
        Router::post('/avatar', [UserController::class, 'uploadAvatar']);
        Router::delete('/avatar', [UserController::class, 'deleteAvatar']);
        Router::post('/banner', [UserController::class, 'uploadBanner']);
        Router::delete('/banner', [UserController::class, 'deleteBanner']);
    });
    
    Router::prefix('/application')->middleware('auth')->group(function() {
        Router::post('/', [ApplicationController::class, 'create']);
        Router::put('/:id', [ApplicationController::class, 'update']);
        Router::delete('/:id', [ApplicationController::class, 'delete']);
        Router::post('/:id/toggle-hidden', [ApplicationController::class, 'toggleHidden']);
    });
});
```

### 2. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

#### –ü—Ä–∏–º–µ—Ä: app/Controllers/Api/ApplicationController.php
```php
<?php

namespace App\Controllers\Api;

use App\Http\Request;
use App\Http\Response;
use App\Repository\ApplicationRepository;
use App\Services\ImageService;
use App\Validators\ApplicationValidator;

class ApplicationController
{
    private ApplicationRepository $appRepo;
    private ImageService $imageService;
    private ApplicationValidator $validator;

    public function __construct()
    {
        $this->appRepo = new ApplicationRepository();
        $this->imageService = new ImageService();
        $this->validator = new ApplicationValidator();
    }

    public function create(Request $request): Response
    {
        $data = $request->all();
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        $errors = $this->validator->validateCreate($data);
        if (!empty($errors)) {
            return Response::json(['errors' => $errors], 400);
        }
        
        // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
        $appId = $this->appRepo->create(
            $data['modpack_id'],
            $request->user()['id'],
            $data['message'],
            $data['discord'] ?? null,
            $data['telegram'] ?? null,
            $data['vk'] ?? null,
            $data['relevant_until'] ?? null
        );
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        if ($request->hasFile('images')) {
            foreach ($request->files('images') as $image) {
                $path = $this->imageService->uploadApplicationImage($image, $appId);
                if ($path) {
                    $this->appRepo->addImage($appId, $path);
                }
            }
        }
        
        return Response::json(['success' => true, 'id' => $appId]);
    }

    public function update(Request $request, int $id): Response
    {
        $app = $this->appRepo->findById($id);
        if (!$app || $app['user_id'] !== $request->user()['id']) {
            return Response::json(['error' => 'Not found'], 404);
        }
        
        $data = $request->all();
        $errors = $this->validator->validateUpdate($data);
        if (!empty($errors)) {
            return Response::json(['errors' => $errors], 400);
        }
        
        $this->appRepo->update(
            $id,
            $request->user()['id'],
            $data['message'],
            $data['discord'] ?? null,
            $data['telegram'] ?? null,
            $data['vk'] ?? null,
            $data['relevant_until'] ?? null
        );
        
        return Response::json(['success' => true]);
    }

    public function delete(Request $request, int $id): Response
    {
        $app = $this->appRepo->findById($id);
        if (!$app || $app['user_id'] !== $request->user()['id']) {
            return Response::json(['error' => 'Not found'], 404);
        }
        
        $this->appRepo->delete($id, $request->user()['id']);
        return Response::json(['success' => true]);
    }
}
```

### 3. –£–ø—Ä–æ—â–µ–Ω–∏–µ AuthManager

#### –ë—ã–ª–æ: AuthManager + 9 —Ç—Ä–µ–π—Ç–æ–≤
#### –°—Ç–∞–Ω–µ—Ç: –û–¥–∏–Ω –∫–ª–∞—Å—Å AuthService

```php
<?php

namespace App\Services;

use App\Repository\UserRepository;
use App\Repository\RefreshTokenRepository;
use App\Auth\JWT;

class AuthService
{
    private JWT $jwt;
    private UserRepository $userRepo;
    private RefreshTokenRepository $tokenRepo;
    private array $config;

    public function __construct()
    {
        $this->config = require CONFIG_PATH . '/app.php';
        $this->jwt = new JWT($this->config['jwt_secret']);
        $this->userRepo = new UserRepository();
        $this->tokenRepo = new RefreshTokenRepository();
    }

    public function register(string $login, string $email, string $password, string $username): array
    {
        // –í—Å—è –ª–æ–≥–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∑–¥–µ—Å—å
        // (–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å RegisterTrait)
    }

    public function login(string $login, string $password, string $ip, string $userAgent): array
    {
        // –í—Å—è –ª–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –∑–¥–µ—Å—å
        // (–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å LoginTrait)
    }

    public function refresh(string $refreshToken): array
    {
        // –í—Å—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∑–¥–µ—Å—å
        // (–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å RefreshTrait)
    }

    public function logout(string $refreshToken): void
    {
        // –í—Å—è –ª–æ–≥–∏–∫–∞ –≤—ã—Ö–æ–¥–∞ –∑–¥–µ—Å—å
        // (–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å LogoutTrait)
    }

    public function getCurrentUser(): ?array
    {
        // –í—Å—è –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–¥–µ—Å—å
        // (–æ–±—ä–µ–¥–∏–Ω–∏—Ç—å GetCurrentUserTrait)
    }

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã...
}
```

### 4. –í–∞–ª–∏–¥–∞—Ü–∏—è

#### app/Validators/ApplicationValidator.php
```php
<?php

namespace App\Validators;

use App\Repository\ApplicationRepository;

class ApplicationValidator
{
    public function validateCreate(array $data): array
    {
        $errors = [];
        
        // Modpack ID
        if (empty($data['modpack_id']) || !is_numeric($data['modpack_id'])) {
            $errors['modpack_id'] = 'Invalid modpack ID';
        }
        
        // Message
        $message = trim($data['message'] ?? '');
        if (empty($message)) {
            $errors['message'] = 'Message is required';
        } elseif (mb_strlen($message) > ApplicationRepository::MAX_MESSAGE_LENGTH) {
            $errors['message'] = 'Message too long';
        }
        
        // Relevant until
        if (isset($data['relevant_until'])) {
            $validation = $this->validateRelevantUntil($data['relevant_until']);
            if (!$validation['valid']) {
                $errors['relevant_until'] = $validation['error'];
            }
        }
        
        return $errors;
    }

    public function validateUpdate(array $data): array
    {
        // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ validateCreate
    }

    private function validateRelevantUntil(?string $date): array
    {
        // –õ–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞—Ç—ã
    }
}
```

### 5. Request/Response –∫–ª–∞—Å—Å—ã

#### app/Http/Request.php
```php
<?php

namespace App\Http;

class Request
{
    private array $data;
    private array $files;
    private ?array $user = null;

    public function __construct()
    {
        $contentType = $_SERVER['CONTENT_TYPE'] ?? '';
        
        if (strpos($contentType, 'application/json') !== false) {
            $this->data = json_decode(file_get_contents('php://input'), true) ?? [];
        } elseif (strpos($contentType, 'multipart/form-data') !== false) {
            $this->data = $_POST;
        } else {
            $this->data = $_REQUEST;
        }
        
        $this->files = $_FILES ?? [];
    }

    public function all(): array
    {
        return $this->data;
    }

    public function get(string $key, $default = null)
    {
        return $this->data[$key] ?? $default;
    }

    public function has(string $key): bool
    {
        return isset($this->data[$key]);
    }

    public function hasFile(string $key): bool
    {
        return isset($this->files[$key]) && $this->files[$key]['error'] === UPLOAD_ERR_OK;
    }

    public function file(string $key): ?array
    {
        return $this->files[$key] ?? null;
    }

    public function files(string $key): array
    {
        if (!isset($this->files[$key])) {
            return [];
        }
        
        $files = $this->files[$key];
        if (isset($files['name']) && !is_array($files['name'])) {
            return [$files];
        }
        
        $result = [];
        foreach ($files['name'] as $i => $name) {
            $result[] = [
                'name' => $name,
                'type' => $files['type'][$i],
                'tmp_name' => $files['tmp_name'][$i],
                'error' => $files['error'][$i],
                'size' => $files['size'][$i],
            ];
        }
        return $result;
    }

    public function user(): ?array
    {
        return $this->user;
    }

    public function setUser(array $user): void
    {
        $this->user = $user;
    }
}
```

#### app/Http/Response.php
```php
<?php

namespace App\Http;

class Response
{
    public static function json(array $data, int $status = 200): void
    {
        http_response_code($status);
        header('Content-Type: application/json; charset=utf-8');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ—à–∏–±–∫–∏ –ë–î –µ—Å–ª–∏ –µ—Å—Ç—å
        if (class_exists('App\Core\Database')) {
            $dbErrors = \App\Core\Database::getErrors();
            if (!empty($dbErrors)) {
                $data['_db_errors'] = $dbErrors;
            }
        }
        
        echo json_encode($data, JSON_UNESCAPED_UNICODE);
        exit;
    }

    public static function redirect(string $url): void
    {
        header("Location: $url");
        exit;
    }

    public static function view(string $template, array $data = []): void
    {
        extract($data);
        require TEMPLATES_PATH . '/' . $template . '.php';
    }
}
```

### 6. Middleware

#### app/Http/Middleware/RateLimitMiddleware.php
```php
<?php

namespace App\Http\Middleware;

use App\Http\Request;
use App\Services\RateLimitService;

class RateLimitMiddleware
{
    private RateLimitService $rateLimitService;

    public function __construct()
    {
        $this->rateLimitService = new RateLimitService();
    }

    public function handle(Request $request, callable $next, int $maxAttempts, int $windowSeconds): void
    {
        $key = $this->getKey($request);
        
        if (!$this->rateLimitService->check($key, $maxAttempts, $windowSeconds)) {
            Response::json(['error' => 'Too many requests'], 429);
        }
        
        $next($request);
    }

    private function getKey(Request $request): string
    {
        $ip = $_SERVER['REMOTE_ADDR'] ?? 'unknown';
        $route = $_SERVER['REQUEST_URI'] ?? '';
        return "rate_limit:{$ip}:{$route}";
    }
}
```

## üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 –¥–Ω—è)
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
2. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã (Router, Request, Response)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É

### –≠—Ç–∞–ø 2: –†–æ—É—Ç–∏–Ω–≥ (2-3 –¥–Ω—è)
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Router
2. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç—ã –≤ routes/
3. –û–±–Ω–æ–≤–∏—Ç—å public/index.php

### –≠—Ç–∞–ø 3: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (3-4 –¥–Ω—è)
1. –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è API
2. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ —Ñ–∞–π–ª–æ–≤ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç

### –≠—Ç–∞–ø 4: –£–ø—Ä–æ—â–µ–Ω–∏–µ (2-3 –¥–Ω—è)
1. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç—Ä–µ–π—Ç—ã –≤ –∫–ª–∞—Å—Å—ã
2. –£–ø—Ä–æ—Å—Ç–∏—Ç—å AuthManager ‚Üí AuthService
3. –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

### –≠—Ç–∞–ø 5: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (2-3 –¥–Ω—è)
1. –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
2. –î–æ–±–∞–≤–∏—Ç—å rate limiting
3. –£–ª—É—á—à–∏—Ç—å CSRF –∑–∞—â–∏—Ç—É
4. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤

### –≠—Ç–∞–ø 6: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (2-3 –¥–Ω—è)
1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL –∑–∞–ø—Ä–æ—Å—ã
2. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—ã

### –≠—Ç–∞–ø 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 –¥–Ω—è)
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–û–±—â–µ–µ –≤—Ä–µ–º—è: 14-21 –¥–µ–Ω—å**

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. ‚úÖ **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, —Å–ª–µ–¥—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
2. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
3. ‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
4. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∑–∞—â–∏—Ç–∞
5. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
6. ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –±–æ–ª—å—à–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è**: –ù–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É
2. **–†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏**: –î–µ–ª–∞—Ç—å –±—ç–∫–∞–ø—ã –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –û–±–Ω–æ–≤–ª—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –º–µ—Ä–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
